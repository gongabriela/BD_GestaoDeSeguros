erDiagram
    %% --- RELAÇÕES DE ENTIDADES E BENS ---
    EntidadePessoa ||--o{ EntidadeBem : "FK_EntidadeID"
    EntidadePessoa ||--o{ ApoliceEntidadePessoa : "FK_EntidadePessoaID"
    EntidadeBem ||--o{ ApoliceEntidadeBem : "FK_EntidadeBemID"

    %% --- RELAÇÕES DE PRODUTOS E PARCERIAS ---
    Seguradora ||--o{ MediadorSeguradora : "FK_SeguradoraID"
    Mediador ||--o{ MediadorSeguradora : "FK_MediadorID"
    Seguradora ||--o{ Produto : "FK_SeguradoraID"
    TipoDeSeguro ||--o{ Produto : "FK_TipoSeguroID"
    Produto ||--o{ ProdutoPlano : "FK_ProdutoID"

    %% --- RELAÇÕES DA APÓLICE ---
    ProdutoPlano ||--o{ Apolice : "FK_ProdutoPlanoID"
    Mediador ||--o{ Apolice : "FK_MediadorID"
    Apolice ||--o{ ApoliceEntidadePessoa : "FK_ApoliceID"
    Apolice ||--o{ ApoliceEntidadeBem : "FK_ApoliceID"
    Apolice ||--o{ HistoricoApolice : "FK_ApoliceID"

    %% --- RELAÇÕES FINANCEIRAS E SINISTROS ---
    Apolice ||--o{ Premio : "FK_ApoliceID"
    Premio ||--o{ Pagamento : "FK_PremioID"
    Apolice ||--o{ Sinistro : "FK_ApoliceID"
    Sinistro ||--o{ HistoricoSinistro : "FK_SinistroID"

    EntidadePessoa {
        smallint EntidadePessoaID PK
        varchar Nome
        char NIF
        enum TipoEntidade
        date DataNascimento
        varchar Morada
        varchar Localidade
        char Telefone
        varchar Email
        enum Status
        varchar Observacoes
    }

    EntidadeBem {
        int EntidadeBemID PK
        smallint EntidadeID FK
        varchar DescricaoBem
        varchar IdentificacaoBem UK
        decimal ValorEstimado
        date DataAquisicao
        varchar Observacoes
    }

    Seguradora {
        smallint SeguradoraID PK
        varchar Nome
        char NIF
        varchar Morada
        varchar Localidade
        varchar Email
        char Telefone
        enum Status
        varchar Observacoes
    }

    Mediador {
        smallint MediadorID PK
        varchar Nome
        char NIF
        varchar Morada
        varchar Localidade
        varchar Email
        char Telefone
        enum Status
        varchar Observacoes
    }

    MediadorSeguradora {
        smallint MediadorID PK_FK
        smallint SeguradoraID PK_FK
        date DataInicio
        date DataFim
        enum Status
        varchar Observacoes
    }

    TipoDeSeguro {
        smallint TipoSeguroID PK
        varchar Descricao
        varchar Observacoes
    }

    Produto {
        smallint ProdutoID PK
        smallint SeguradoraID FK
        smallint TipoSeguroID FK
        varchar NomeProduto
        enum Status
        varchar Observacoes
    }

    ProdutoPlano {
        int ProdutoPlanoID PK
        smallint ProdutoID FK
        varchar NomePlano
        varchar Cobertura
        date DataInicioVigencia
        date DataFimVigencia
        varchar Observacoes
    }

    Apolice {
        int ApoliceID PK
        int ProdutoPlanoID FK
        smallint MediadorID FK
        int EntidadeBemID FK
        date DataEmissao
        date DataInicioVigencia
        date DataFimVigencia
    }

    ApoliceEntidadePessoa {
        int ApoliceEntidadeID PK
        int ApoliceID FK
        smallint EntidadePessoaID FK
        enum Papel
    }

    ApoliceEntidadeBem {
        int ApoliceEntidadeBemID PK
        int ApoliceID FK
        int EntidadeBemID FK
    }

    HistoricoApolice {
        int HistoricoApoliceID PK
        int ApoliceID FK
        datetime DataAlteracao
        enum EstadoAnterior
        enum EstadoNovo
        varchar DescricaoAlteracao
    }

    Premio {
        int PremioID PK
        int ApoliceID FK
        decimal ValorContratado
        enum Periodicidade
        date DataVencimento
        varchar Observacoes
    }

    Pagamento {
        int PagamentoID PK
        int PremioID FK
        date DataPagamento
        decimal ValorPago
        enum MetodoPagamento
    }

    Sinistro {
        int SinistroID PK
        int ApoliceID FK
        date DataOcorrencia
        date DataParticipacao
        varchar Descricao
        decimal ValorReclamado
        decimal ValorIndenizacaoTotal
        enum Status
        varchar Observacoes
    }

    HistoricoSinistro {
        int HistoricoSinistroID PK
        int SinistroID FK
        datetime DataAlteracao
        enum EstadoAnterior
        enum EstadoNovo
        decimal ValorIndemnizadoNestaFase
        varchar DescricaoAlteracao
    }
